<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ªäÊó•„ÅÆÂ§©Ê∞ó</title>
    <style>
        /* Ë¶ã„ÅüÁõÆ„ÇíÊï¥„Åà„Çã„Åü„ÇÅ„ÅÆCSSÔºàÈõ∞Âõ≤Ê∞óÔºâ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: grid;
            place-items: center;
            min-height: 100vh;
            background-color: #f0f4f8;
            color: #333;
        }
        #weather-card {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 24px;
            width: 300px;
            text-align: center;
        }
        #status {
            font-size: 1.1em;
            color: #555;
        }
        #temperature {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
            color: #1a73e8;
        }
        #weather {
            font-size: 1.5em;
            font-weight: 500;
        }
        #location {
            font-size: 0.9em;
            color: #777;
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <div id="weather-card">
        <div id="status">Â§©Ê∞ó„ÇíÂèñÂæó‰∏≠...</div>
        <div id="temperature"></div>
        <div id="weather"></div>
        <div id="location"></div>
    </div>

    <script>
        // „Éö„Éº„Ç∏„ÅåË™≠„ÅøËæº„Åæ„Çå„Åü„ÇâÂÆüË°å
        window.addEventListener('load', () => {
            // 1. „Éñ„É©„Ç¶„Ç∂„ÅÆ‰ΩçÁΩÆÊÉÖÂ†±ÔºàÁ∑ØÂ∫¶„ÉªÁµåÂ∫¶Ôºâ„ÇíÂèñÂæó„Åô„Çã
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
            } else {
                updateStatus("‰ΩçÁΩÆÊÉÖÂ†±„ÅåÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü„ÄÇ");
            }
        });

        // ‰ΩçÁΩÆÊÉÖÂ†±„ÅÆÂèñÂæó„Å´ÊàêÂäü„Åó„ÅüÂ†¥Âêà
        async function successCallback(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            
            updateStatus("Â§©Ê∞óÊÉÖÂ†±„ÇíÂèñÂæó‰∏≠...");

            // 2. Open-Meteo API„Å´Á∑ØÂ∫¶„ÉªÁµåÂ∫¶„ÇíÊ∏°„Åó„Å¶Â§©Ê∞ó„ÇíÂïè„ÅÑÂêà„Çè„Åõ„Çã
            const apiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,weather_code&timezone=Asia%2FTokyo`;

            try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                // 3. ÂèñÂæó„Åó„Åü„Éá„Éº„Çø„ÇíË°®Á§∫„Åô„Çã
                displayWeather(data);

            } catch (error) {
                console.error("API„Ç®„É©„Éº:", error);
                updateStatus("Â§©Ê∞óÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ");
            }
        }

        // ‰ΩçÁΩÆÊÉÖÂ†±„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„ÅüÂ†¥Âêà
        function errorCallback(error) {
            console.error("‰ΩçÁΩÆÊÉÖÂ†±„Ç®„É©„Éº:", error);
            updateStatus("‰ΩçÁΩÆÊÉÖÂ†±„ÅÆÂèñÂæó„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ");
        }

        // Â§©Ê∞óÊÉÖÂ†±„ÇíHTML„Å´ÂèçÊò†„Åô„Çã
        function displayWeather(data) {
            const temp = data.current.temperature_2m;
            const weatherCode = data.current.weather_code;
            const weatherText = translateWeatherCode(weatherCode);
            
            const timezone = data.timezone.split('/')[1] || data.timezone; // "Asia/Tokyo" -> "Tokyo"

            document.getElementById("status").style.display = 'none'; // "ÂèñÂæó‰∏≠..."„ÇíÈö†„Åô
            document.getElementById("temperature").textContent = `${temp} ‚ÑÉ`;
            document.getElementById("weather").textContent = weatherText;
            document.getElementById("location").textContent = `ÁèæÂú®„ÅÆÂ†¥ÊâÄ: ${timezone} ‰ªòËøë`;
        }
        
        // „Çπ„ÉÜ„Éº„Çø„Çπ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÊõ¥Êñ∞„Åô„Çã
        function updateStatus(message) {
            document.getElementById("status").textContent = message;
        }

        // API„Åã„ÇâËøî„Åï„Çå„ÇãÂ§©Ê∞ó„Ç≥„Éº„Éâ„ÇíÊó•Êú¨Ë™û„Å´Â§âÊèõ„Åô„Çã
        function translateWeatherCode(code) {
            // (Á∞°ÊòìÁâà„Åß„Åô)
            if (code === 0) return "Âø´Êô¥ ‚òÄÔ∏è";
            if (code === 1) return "Êô¥„Çå üå§Ô∏è";
            if (code === 2) return "‰∏ÄÈÉ®Êõá„Çä üå•Ô∏è";
            if (code === 3) return "Êõá„Çä ‚òÅÔ∏è";
            if (code >= 45 && code <= 48) return "Èúß üå´Ô∏è";
            if (code >= 51 && code <= 55) return "ÈúßÈõ® üåßÔ∏è";
            if (code >= 61 && code <= 65) return "Èõ® üåßÔ∏è";
            if (code >= 66 && code <= 67) return "„Åø„Åû„Çå üå®Ô∏è";
            if (code >= 71 && code <= 75) return "Èõ™ ‚ùÑÔ∏è";
            if (code === 77) return "Èõ™ÔºàÁ≤íÔºâ ‚ùÑÔ∏è";
            if (code >= 80 && code <= 82) return "„Å´„Çè„ÅãÈõ® üåßÔ∏è";
            if (code >= 85 && code <= 86) return "„Å´„Çè„ÅãÈõ™ ‚ùÑÔ∏è";
            if (code >= 95 && code <= 99) return "Èõ∑Èõ® ‚õàÔ∏è";
            return "‰∏çÊòé";
        }

    </script>
</body>
</html>